## keep-alive 缓存失效

### 常见原因：

- 未正确设置 `include` / `exclude`
- 动态组件未设置 `key`，导致缓存混乱
- 被 `v-if` 控制而非 `v-show`，导致组件销毁
- 缓存超过 `max` 限制被移出缓存

### 解决建议：

- 使用 `:include="['ComponentA']"` 明确包含目标组件
- 动态组件绑定唯一 `key`
- 使用 `v-show` 控制显隐避免销毁

## watch 监听对象属性失效

### 问题：

直接监听对象无法监听其内部属性变化。

```js
watch(
  () => obj,
  (newVal) => {
    // 只监听 obj 整体变化，属性变了不会触发
  },
);
```

### 解决方案

- 使用深度监听（deep）
- 分开监听具体属性

```js
watch(() => obj.prop, handler);
watch(obj, handler, { deep: true });
```

## nextTick 失效与微任务理解

### 场景：

> DOM 更新尚未完成，nextTick 中却未获取预期 DOM 结果。

### 原因：

- 操作顺序错误
- 渲染未被触发（响应式未变化）

### 原理：

- nextTick 是微任务，在 DOM 更新完成后触发
- 和 Promise.then 同级别
- 多次调用合并为一个任务队列

**建议：**

> 确保触发响应式变更后再调用 nextTick

## 子组件 props 更新未同步

### 原因：

- 子组件未声明 props，Vue 不做绑定
- 子组件内部改写了 props（Vue2 不推荐）

### 解决：

- 正确声明 props 接收
- 若需要本地修改，使用 computed 或 data 拷贝

```js
props: ['value'],
data() {
  return { localValue: this.value };
}
```

## template 中多个根节点问题（Vue2）

### 问题：

> Vue2 中一个组件模板只能有一个根节点，多个节点会报错。

### 解决：

- 使用一个 <div> 包裹所有内容
- 或使用 <template> 进行结构组织

### Vue3 改进：

- 支持 Fragment，可返回多个根节点

## 生命周期在页面缓存/动态组件下的差异

### keep-alive

| 生命周期              | 是否触发       |
| --------------------- | -------------- |
| created               | 首次渲染时执行 |
| mounted               | 首次渲染时执行 |
| activated             | 每次激活时执行 |
| deactivated           | 缓存前执行     |
| destroyed / unmounted | 不会执行       |

### 动态组件切换

- 若组件没有被 keep-alive 包裹：
- 会销毁原组件，重新挂载新组件
- 若有缓存，则执行 activated / deactivated
