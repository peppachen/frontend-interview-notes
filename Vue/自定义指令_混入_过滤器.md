## 自定义指令

**常用场景：权限控制、粘贴处理、懒加载**

- 避免组件中重复逻辑
- 提升复用性和代码语义
- 更接近原生 DOM 操作
- 强化项目可维护性与可配置性

### 指令创建注册

#### vue2

```js
// 全局注册指令
Vue.directive("focus", {
  inserted(el) {
    el.focus();
  },
});
```

```html
<!-- 使用 -->
<input v-focus />
```

#### vue3

**Vue3 自定义指令以函数或对象形式注册：**

```ts
// 方法一、函数简写
const app = createApp(App);

app.directive("focus", (el) => {
  el.focus();
});

// 发放二、完整钩子对象
app.directive("focus", {
  mounted(el) {
    el.focus();
  },
  updated(el) {
    console.log("元素更新");
  },
  unmounted(el) {
    console.log("元素卸载");
  },
});
```

```html
<!-- 使用 -->
<input v-focus />
```

## 指令生命周期钩子

| Vue2 钩子        | Vue3 对应钩子 | 说明                        |
| ---------------- | ------------- | --------------------------- |
| bind             | created（无） | 指令绑定时（Vue3 无此钩子） |
| inserted         | mounted       | 元素插入父节点              |
| update           | beforeUpdate  | 组件更新前                  |
| componentUpdated | updated       | 组件更新后                  |
| unbind           | unmounted     | 指令解绑                    |

## 混入（Mixin）与组合式 API 区别

| 特性           | Mixin                   | Composition API (Vue3) |
| -------------- | ----------------------- | ---------------------- | ------------------ |
| 状态管理方式   | 多个 mixin 会冲突       | 逻辑集中、易于组织     |
| 复用逻辑       | 不清晰、来源不明        | 更清晰，函数式组织     |
| this 指向      | 依赖上下文              | 与上下文无关           |
| 类型推导       | 较弱，难配合 TS         | 类型更友好，TS 支持好  |
| 可读性与维护性 | 随 mixin 数量增加而下降 |                        | 更好控制，逻辑清晰 |

## 过滤器（Vue3 已移除）与替代方案

**使用 方法 或 计算属性 替代。**

### （Vue2）：

```html
<span>{{ price | currency }}</span>
```

```js
Vue.filter("currency", (val) => "¥" + val.toFixed(2));
```

### Vue3

1. 方法

```html
<span>{{ formatCurrency(price) }}</span>
```

```js
methods: {
  formatCurrency(val) {
    return '¥' + val.toFixed(2)
  }
}

```

2. 计算属性

```js
computed: {
  formattedPrice() {
    return '¥' + this.price.toFixed(2)
  }
}
```
